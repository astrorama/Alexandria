/**
 * @file SedIntegration_test.cpp
 *
 * Created on: Sep 16, 2013
 *     Author: Pierre Dubath
 */

#include <iostream>
#include <cmath>
#include <map>
#include <iomanip>
#include <vector>
#include <boost/test/unit_test.hpp>
#include <boost/filesystem/path.hpp>

//#include "ChDataModel/Source.h"
#include "ChDataModel/Enumerations/FilterTypes.h"
#include "ChDataHandling/AsciiFilterImporter.h"
#include "ChDataHandling/AsciiSedImporter.h"

#include "Faros/SedIntegration.h"


namespace fs = boost::filesystem;

using namespace ChDataModel;
using namespace std;

//-----------------------------------------------------------------------------

struct SedIntegrationFix {

  char* strPath;
  std::string alexandriaPath{};

  SedIntegration*       sed_integration_ptr = nullptr;
  AsciiFilterImporter*  inputFilter         = nullptr;
  AsciiSedImporter*     inputSed            = nullptr;

  FilterTypes           filterType{};


  double tolerence{};

  SedIntegrationFix() {

    // Get Alexandria path
    strPath = getenv("ALEXANDRIA_PROJECT_ROOT");
    alexandriaPath = "";
    if (strPath != NULL)
    {
      alexandriaPath = std::string(strPath);
    }
    else
    {
      cout << "ERROR : <ALEXANDRIA_PROJECT_ROOT> environment variable is empty!!!"<<endl;
    }

    // setup
    sed_integration_ptr = new SedIntegration(InterpolationMethod::CUBIC);
    inputFilter         = new AsciiFilterImporter();
    inputSed            = new AsciiSedImporter();

    tolerence    = 1e-5;
    filterType   = FilterTypes::EUCLID;

  }
  ~SedIntegrationFix() {
    // teardown
    delete sed_integration_ptr;
    delete inputFilter;
//    delete inputSed;
 }

};

//-----------------------------------------------------------------------------

BOOST_AUTO_TEST_SUITE (SedIntegration_test)

// BOOST_GLOBAL_FIXTURE(PV); // this does not work as test case do not have access to PV members!?!?

// BOOST_AUTO_TEST_CASE( constructors_test ) { // this is a test case that do not depend on fixture

//-----------------------------------------------------------------------------

BOOST_FIXTURE_TEST_CASE( Default_constructor_test, SedIntegrationFix ) {
  BOOST_CHECK(sed_integration_ptr);
}



BOOST_FIXTURE_TEST_CASE( Simple_sed_integration_test, SedIntegrationFix ) {

  // the tolerence is expressed in relative difference in percent
  tolerence = 1e-4;

  /*
   * The expected result has been obtained with Python, with the following code
   *
   * # load SED "lePhare/lephare_dev/sed/GAL/CFHTLS_SED/Sbc_cww_13.sed"
   * sed_wave, sed_flux = np.loadtxt(sed_path+'Sbc_cww_13.sed', unpack=True)
   *
   * # interpolate SED template
   * SED = interpolate.interp1d(sed_wave, sed_flux)
   *
   * # integration
   * integration, foo = scipy.integrate.quad(lambda x: SED(x), np.min(sed_wave), np.max(sed_wave))
   *
   * "python_result" below equals to above "integration"
   */
  double python_result = 12206.871644;

  // This is the (large) vector of fluxes from the
  //    "lePhare/lephare_dev/sed/GAL/CFHTLS_SED/Sbc_cww_13.sed"
  vector<double> sed_flux {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1.25804,1.255496,1.252709,1.250165,1.247134,1.244291,1.241747,1.23896,1.236416,1.233629,1.231085,1.228298,1.225641,1.222611,1.219824,1.21728,1.214493,1.211949,1.209162,1.206561,1.203774,1.20123,1.1982,1.195413,1.192869,1.190082,1.187482,1.184694,1.182094,1.17955,1.176763,1.173733,1.170889,1.168346,1.165558,1.163014,1.160227,1.157683,1.155139,1.152296,1.149266,1.146478,1.143934,1.141147,1.138547,1.13576,1.13316,1.130616,1.127829,1.124798,1.122011,1.119467,1.11668,1.11408,1.111536,1.108749,1.106205,1.103418,1.100387,1.0976,1.095,1.092157,1.089613,1.087069,1.084282,1.081738,1.078951,1.075864,1.073077,1.070533,1.067746,1.065202,1.062658,1.059871,1.057271,1.054483,1.051453,1.04861,1.046066,1.043522,1.040679,1.038135,1.035347,1.032803,1.02953,1.026986,1.024199,1.021655,1.019055,1.015052,1.011049,1.006802,1.000723,0.9917679,0.9828125,0.9739133,0.9650141,0.9561148,0.9472156,0.9383164,0.9294171,0.9204618,0.9115625,0.9026633,0.8937641,0.8846291,0.8752283,0.8658275,0.8564267,0.8477113,0.8391409,0.8305705,0.8220001,0.8134297,0.8048592,0.7962888,0.7877184,0.779148,0.7705776,0.7620071,0.7534367,0.7455366,0.7385465,0.7371469,0.7357474,0.7343478,0.7329482,0.7315486,0.7301491,0.7287495,0.7273499,0.7259504,0.7245508,0.7203254,0.7129363,0.7055472,0.6981581,0.690769,0.68338,0.6759909,0.6719885,0.6724439,0.6728993,0.6733547,0.6738101,0.6742655,0.6747209,0.6751763,0.6756317,0.6760871,0.6764055,0.6739287,0.6726884,0.6716537,0.6706191,0.6695845,0.6685499,0.6675153,0.6670202,0.6666857,0.6663511,0.6660165,0.665682,0.6653474,0.6651428,0.6645369,0.6639133,0.6632897,0.6626661,0.6620425,0.6614189,0.6607953,0.6603551,0.6608462,0.6613372,0.661924,0.6627334,0.6635429,0.6643523,0.6651618,0.6660106,0.6670866,0.6681627,0.6692387,0.6703147,0.6713907,0.6724667,0.6735428,0.6746188,0.6756948,0.6746935,0.6724547,0.6699324,0.6671338,0.6643351,0.6675345,0.6733923,0.6793306,0.6855943,0.6866934,0.6853852,0.6840769,0.6827687,0.6814605,0.6801522,0.678844,0.6775358,0.6762275,0.6772831,0.6782694,0.6791701,0.6800708,0.6809714,0.6818721,0.6827728,0.6833452,0.6837733,0.6842015,0.6846297,0.6850578,0.685486,0.6859142,0.6863423,0.6866103,0.6866903,0.686717,0.6867437,0.6867704,0.686797,0.6869277,0.6879042,0.6888808,0.6898573,0.6908339,0.6918105,0.692787,0.6938326,0.6965649,0.700292,0.7040191,0.7077461,0.7110174,0.7136327,0.7155606,0.7174885,0.7194164,0.7213443,0.7232722,0.725258,0.72741,0.729562,0.7317141,0.7338661,0.7360181,0.7381701,0.7403222,0.7424742,0.7484194,0.7562567,0.764094,0.7719312,0.7797685,0.7872704,0.7934711,0.7996717,0.8059503,0.8122744,0.8185986,0.8249228,0.8311799,0.836653,0.842126,0.8475991,0.8530721,0.8585452,0.8640182,0.8694913,0.8749643,0.8792453,0.8835079,0.8877705,0.8920331,0.8962957,0.9008463,0.9069753,0.9131043,0.9192332,0.9253622,0.9314912,0.9376202,0.9437492,0.9495855,0.9545513,0.9593562,0.9641611,0.968966,0.9737709,0.9785758,0.9833807,0.9881856,0.9929905,0.9980944,1.003228,1.008362,1.013495,1.018629,1.023763,1.028896,1.03403,1.039231,1.044157,1.048325,1.052493,1.056661,1.060828,1.064996,1.069164,1.073081,1.077664,1.082247,1.086207,1.089083,1.091958,1.094834,1.09771,1.100586,1.102151,1.102948,1.103745,1.104542,1.105339,1.106136,1.106933,1.10773,1.108527,1.112776,1.118354,1.123931,1.129509,1.135086,1.140664,1.145775,1.147792,1.147469,1.147147,1.146824,1.146502,1.146179,1.145857,1.145534,1.145211,1.144889,1.144566,1.145147,1.145951,1.146756,1.14756,1.148365,1.149169,1.149974,1.150778,1.151583,1.152387,1.152169,1.151562,1.150955,1.150348,1.149741,1.149134,1.148527,1.14792,1.147313,1.146706,1.146099,1.144722,1.143001,1.14128,1.139559,1.137839,1.136118,1.134397,1.132676,1.135333,1.138491,1.14165,1.144837,1.148281,1.148542,1.147439,1.146336,1.145233,1.14413,1.143027,1.141925,1.140822,1.139719,1.138616,1.137513,1.136411,1.135308,1.134205,1.133102,1.131999,1.130896,1.129563,1.127618,1.125677,1.123735,1.121794,1.119852,1.117911,1.11597,1.11505,1.11462,1.11419,1.11376,1.11333,1.11291,1.113337,1.113765,1.113536,1.112833,1.112131,1.111428,1.110726,1.110023,1.109321,1.108618,1.107916,1.107214,1.106511,1.105809,1.105106,1.104404,1.103701,1.102357,1.100399,1.098441,1.096483,1.094525,1.092568,1.09061,1.088652,1.086614,1.084236,1.081858,1.079481,1.077103,1.074725,1.072347,1.069969,1.068697,1.068996,1.069296,1.069596,1.069896,1.070196,1.070495,1.070795,1.071095,1.071395,1.071694,1.071484,1.06997,1.068455,1.066941,1.065427,1.063913,1.062398,1.060884,1.05937,1.057855,1.056341,1.05483,1.053667,1.052503,1.051339,1.050175,1.049012,1.047848,1.046684,1.04552,1.044357,1.043193,1.042029,1.040865,1.039702,1.038538,1.03779,1.037904,1.038017,1.038131,1.038244,1.038358,1.038471,1.038585,1.038698,1.038812,1.038925,1.039039,1.039152,1.039266,1.039092,1.03761,1.036129,1.034648,1.033167,1.031686,1.030205,1.028392,1.026595,1.024797,1.023112,1.021315,1.019573,1.017776,1.016091,1.014294,1.012608,1.010811,1.00907,1.007272,1.005475,1.00379,1.001992,1.000467,0.9993028,0.9982506,0.9970861,0.9959778,0.9948134,0.9937612,0.9925968,0.9915446,0.9903801,0.9892157,0.987939,0.9867746,0.9856101,0.9845579,0.9834496,0.9823974,0.9814013,0.9802369,0.9791286,0.9779642,0.976912,0.9757475,0.9745831,0.9735309,0.9723664,0.9712581,0.9700937,0.9690415,0.9678771,0.9667491,0.9661129,0.9653646,0.9647285,0.9642046,0.9636246,0.9631568,0.9626329,0.9619968,0.9614729,0.9608368,0.9602568,0.9596207,0.9590968,0.9584607,0.9578807,0.9572446,0.9566085,0.9560846,0.9554485,0.9548685,0.9542323,0.9537085,0.9530723,0.9524923,0.9519123,0.9513323,0.9506962,0.9501723,0.9495362,0.9489001,0.9483201,0.9479631,0.9468782,0.9456623,0.9446335,0.9432493,0.941678,0.9402938,0.9387786,0.9378807,0.9367958,0.9356547,0.9343266,0.9332417,0.9323438,0.9308286,0.9299307,0.9288458,0.9274615,0.9264327,0.9252917,0.9239636,0.9229909,0.9222052,0.9206339,0.9198483,0.9187072,0.9175662,0.916238,0.9146668,0.9133386,0.9121976,0.9109256,0.9094666,0.908737,0.9077643,0.9065485,0.9054074,0.9045656,0.9029382,0.9019094,0.9010676,0.9000388,0.8987107,0.897738,0.896597,0.8952127,0.8941839,0.893286,0.8917147,0.8908168,0.889788,0.8884038,0.8874311,0.8864584,0.8852425,0.8842698,0.8834842,0.8818568,0.881015,0.879874,0.8788451,0.8781156,0.877517,0.8764882,0.8755903,0.874019,0.8731211,0.8720923,0.8709513,0.8701095,0.8689684,0.868426,0.8672101,0.8662374,0.8655079,0.8640488,0.863151,0.8621221,0.8609811,0.8595968,0.8586241,0.8577824,0.8562672,0.8554255,0.8543966,0.8532556,0.852657,0.8517591,0.8507303,0.849346,0.8482611,0.84712,0.8463905,0.8454178,0.8449315,0.844202,0.8431731,0.8417889,0.8406478,0.839619,0.8387773,0.8377484,0.8370189,0.8364203,0.8347929,0.8340073,0.8328662,0.8315381,0.8309956,0.8299107,0.8291251,0.8281524,0.8270674,0.8262818,0.8251968,0.823981,0.8228399,0.8216988,0.8209132,0.8197721,0.8192297,0.8183318,0.8172468,0.816218,0.8153763,0.8144036,0.8136179,0.8130193,0.8119905,0.8109056,0.8101199,0.809035,0.8082494,0.8071644,0.8066219,0.805537,0.8047514,0.8036664,0.8029369,0.8019081,0.8008231,0.8005238,0.7994389,0.7979799,0.7971942,0.7961654,0.7954359,0.7943509,0.7933221,0.7925926,0.7915077,0.790535,0.7897493,0.7886644,0.7878787,0.7867938,0.7862513,0.7854096,0.7843807,0.7832958,0.7825102,0.7814252,0.7803964,0.7801532,0.7790683,0.7780395,0.7771977,0.7761689,0.775084,0.7742983,0.7736997,0.7726709,0.7719414,0.7709126,0.7698276,0.7690981,0.7685556,0.7674707,0.7667412,0.7657123,0.7649828,0.7638979,0.7628691,0.7622705,0.7614848,0.7603999,0.7596143,0.7585293,0.7575566,0.756771,0.7561724,0.7551436,0.7543018,0.7533291,0.7523003,0.7514585,0.7509722,0.7499434,0.7491016,0.7481289,0.7471001,0.7463706,0.745772,0.7447431,0.7440136,0.743415,0.7423862,0.7418999,0.7411142,0.7401415,0.7395429,0.7387573,0.7376723,0.7366997,0.7364004,0.7353154,0.7342866,0.7334448,0.732416,0.7315743,0.7305454,0.7299468,0.728918,0.7280763,0.7275338,0.7264489,0.7257193,0.7251769,0.7240919,0.7237926,0.7227077,0.7216789,0.7211925,0.7203508,0.7193781,0.7186485,0.7176197,0.716647,0.7159175,0.7153189,0.7143462,0.7136167,0.7125879,0.7121015,0.7113159,0.7102309,0.7097446,0.7087158,0.7084726,0.7073877,0.7063588,0.7061157,0.7050307,0.7040019,0.7037587,0.7026738,0.7021874,0.7011586,0.7003169,0.6998305,0.6988017,0.6980722,0.6974736,0.6964448,0.6962016,0.6951167,0.6940878,0.6936015,0.6927597,0.6922734,0.6912446,0.6904028,0.6899164,0.6888876,0.6881581,0.6875595,0.6865307,0.6860443,0.6852026,0.6841738,0.6836874,0.6829018,0.6824154,0.6814427,0.6808441,0.680601,0.6796283,0.6790858,0.6783563,0.6778699,0.6772713,0.6762986,0.6760555,0.6750266,0.6744281,0.6739417,0.6731561,0.6725575,0.6715848,0.6710423,0.6707991,0.6697142,0.6691717,0.6686854,0.6678436,0.6673573,0.6663284,0.6657298,0.6654867,0.6644579,0.6638593,0.6631297,0.6630736,0.6630736,0.6630736,0.6630736,0.6629614,0.6629614,0.6629614,0.6629053,0.6629053,0.6629053,0.664645,0.6658423,0.6584721,0.6510458,0.652243,0.6532531,0.6596693,0.6663286,0.6665531,0.6667215,0.6615586,0.6565828,0.6541136,0.651345,0.6509709,0.6504846,0.649886,0.6496428,0.6494745,0.6493061,0.6502227,0.6518689,0.6500918,0.6485018,0.6478471,0.6473046,0.6473046,0.646706,0.644985,0.6433202,0.6412438,0.6394667,0.638812,0.6381573,0.6407575,0.6439001,0.6403459,0.6366047,0.6406827,0.6450038,0.6459391,0.6473046,0.6459952,0.6452844,0.6409633,0.6362867,0.6354076,0.6339298,0.6327513,0.6313857,0.6280186,0.6242213,0.6225377,0.6207232,0.6210038,0.6212283,0.618254,0.61571,0.6164583,0.6174497,0.6162712,0.6149618,0.6135963,0.6119314,0.6105659,0.6094996,0.6081341,0.6067124,0.6055901,0.6042806,0.6031583,0.6012503,0.5998847,0.5987062,0.5973968,0.5962744,0.5949089,0.5934872,0.592421,0.5910555,0.5894467,0.587969,0.5865473,0.5849386,0.5834608,0.5818521,0.5804304,0.5791958,0.5773439,0.5762215,0.5747999,0.5728357,0.5717134,0.5703478,0.5686269,0.5672052,0.5660829,0.5641187,0.5627532,0.5615747,0.5596106,0.5584882,0.5566363,0.5554017,0.55398,0.5523713,0.5508935,0.549528,0.547807,0.5463854,0.5447766,0.5432989,0.5421765,0.5402685,0.5390339,0.537182,0.5357042,0.5345818,0.5326738,0.5314392,0.5300737,0.528465,0.5270433,0.5256778,0.5239568,0.5225913,0.5214128,0.5200472,0.5183824,0.5170168,0.5155391,0.5139303,0.5125087,0.5113863,0.5100208,0.5083559,0.5068782,0.5055126,0.5038478,0.5024822,0.5013599,0.5000504,0.4986288,0.4975064,0.4961409,0.4945883,0.4931666,0.4918011,0.4906226,0.4893693,0.4881908,0.4868253,0.4854036,0.4843373,0.4829718,0.4813631,0.4800537,0.478632,0.4775096,0.4761441,0.4750778,0.4737684,0.472459,0.4713928,0.4705697,0.4692041,0.4681379,0.4668285,0.4655191,0.4644528,0.4631434,0.4622642,0.4611979,0.4598885,0.4585791,0.4575129,0.4562034,0.4548379,0.4537716,0.4529486,0.4516953,0.450629,0.449806,0.4486088,0.4475425,0.4468317,0.4455223,0.4447553,0.4436891,0.4423797,0.4416688,0.4406026,0.4398917,0.4385823,0.4375722,0.4367491,0.4354958,0.4344857,0.4336626,0.4324654,0.4316985,0.4312308,0.4299775,0.4292667,0.4280695,0.4275457,0.4268349,0.4255816,0.4248708,0.424347,0.4231498,0.4223829,0.421672,0.420718,0.4199511,0.4192964,0.4180992,0.4175754,0.4168646,0.4156113,0.4149004,0.4144889,0.4138342,0.4131234,0.4124687,0.4118139,0.411047,0.4106355,0.4099808,0.4088397,0.4081289,0.4077173,0.4070626,0.4063518,0.4056971,0.4050424,0.4045186,0.4038639,0.4032092,0.4024983,0.4018997,0.401245,0.4008896,0.4002349,0.4000665,0.399468,0.3988132,0.3981585,0.397747,0.3976909,0.3970362,0.3963815,0.3957267,0.395072,0.3949598,0.3945483,0.3939497,0.393295,0.3926964,0.392528,0.3918733,0.3913308,0.3909754,0.390807,0.3902646,0.3896099,0.3890113,0.3884688,0.3883004,0.387945,0.3872903,0.3867478,0.3866917,0.386037,0.3854384,0.3850269,0.3844844,0.3843722,0.3837175,0.383175,0.3825203,0.382408,0.3818656,0.3816972,0.3813418,0.3807993,0.3806871,0.3800324,0.3794899,0.3793777,0.3787791,0.3784237,0.3783675,0.3777128,0.3771142,0.3770581,0.3764034,0.3758048,0.3757487,0.375094,0.3746825,0.3740839,0.3734292,0.3727744,0.3721197,0.3717643,0.3711096,0.3704549,0.3698563,0.3692016,0.3687901,0.3681353,0.3674806,0.3668259,0.3661712,0.3655165,0.3654604,0.3650488,0.3643941,0.3637394,0.3625422,0.3620185,0.3608213,0.3600543,0.3592313,0.3582773,0.3575103,0.3563131,0.3556023,0.3550785,0.3538813,0.3531144,0.3524036,0.3513934,0.3506826,0.3493732,0.3486623,0.3481386,0.3469414,0.3461744,0.3455197,0.3452204,0.3445657,0.343911,0.3432563,0.3426016,0.3423023,0.3416476,0.3414792,0.3408245,0.3402259,0.3395712,0.3389165,0.338505,0.3379625,0.3373078,0.3366531,0.3359984,0.3356991,0.3350444,0.334876,0.3342213,0.3335666,0.3329119,0.3325003,0.332332,0.3317334,0.3310787,0.3304239,0.3297692,0.3296009,0.3290023,0.3285907,0.327936,0.3272813,0.3266827,0.3265144,0.3258597,0.3254481,0.3247934,0.3241387,0.323484,0.3233156,0.322717,0.3220623,0.3216508,0.3209961,0.3203414,0.3196867,0.3195183,0.3188636,0.3184521,0.3177973,0.3171426,0.3164879,0.3158332,0.3156649,0.3152533,0.3145986,0.3139439,0.3134014,0.3132331,0.3126345,0.3119798,0.3116805,0.3115121,0.3108574,0.3102588,0.3096041,0.309548,0.3088933,0.308594,0.3084256,0.307827,0.3071723,0.3065176,0.3064615,0.3058068,0.3054513,0.305283,0.3047405,0.3046283,0.3040858,0.3040858,0.3034872,0.3034311,0.3028325,0.3027764,0.3021778,0.3021217,0.3020656,0.3017101,0.301654,0.3010554,0.3009993,0.300513,0.3004007,0.2998582,0.299746,0.2992035,0.2990913,0.2990352,0.2986798,0.2986236,0.2981373,0.298025,0.2979689,0.2973703,0.2973142,0.2967156,0.2966595,0.2966595,0.2960609,0.2960048,0.2954062,0.2953501,0.2952378,0.2949386,0.2949386,0.2943961,0.2942838,0.2942838,0.2942838,0.2942838,0.2937414,0.2937414,0.2937414,0.2937414,0.2936291,0.2931428,0.2931428,0.2931428,0.2930867,0.2930867,0.2926003,0.2924881,0.2924881,0.2924881,0.2924881,0.2921888,0.2921888,0.2921888,0.2921888,0.2921888,0.2921888,0.2921888,0.2921888,0.2921888,0.2921888,0.2921888,0.2921888,0.2917024,0.2917024,0.2917024,0.2917024,0.2917024,0.2917024,0.2917024,0.2917024,0.2915902,0.2915902,0.2915902,0.2915902,0.2911038,0.2910477,0.2910477,0.2910477,0.2910477,0.2910477,0.2909355,0.2909355,0.2909355,0.2909355,0.2909355,0.2904491,0.290393,0.290393,0.290393,0.290393,0.290393,0.2902808,0.2902808,0.2897383,0.2897383,0.2896261,0.2896261,0.2896261,0.2895699,0.2893268,0.2892145,0.2892145,0.2892145,0.2891584,0.288672,0.2885598,0.2885598,0.2885037,0.2885037,0.2885037,0.2879051,0.287849,0.2877367,0.2872504,0.2871943,0.2871381,0.2865396,0.2864834,0.2863712,0.2858848,0.2858287,0.2857165,0.2854172,0.2853049,0.2852488,0.2851366,0.2846502,0.2845941,0.2844819,0.2839394,0.2838272,0.2838272,0.2832847,0.2831725,0.2831725,0.2831163,0.2825177,0.2825177,0.2824616,0.2821062,0.2821062,0.2820501,0.2819378,0.2814515,0.2813954,0.2812831,0.2812831,0.2807407,0.2807407,0.2806845,0.2805723,0.2800859,0.2800859,0.2800859,0.2800298,0.2800298,0.2800298,0.2800298,0.2800298,0.2799176,0.2799176,0.2794312,0.2794312,0.2794312,0.2793751,0.2793751,0.2793751,0.2793751,0.2793751,0.2792629,0.2792629,0.2790197,0.2790197,0.2790197,0.2789636,0.2789636,0.2789636,0.2789636,0.2784772,0.278365,0.278365,0.278365,0.278365,0.278365,0.2783089,0.2778225,0.2778225,0.2778225,0.2778225,0.2777103,0.2777103,0.2771678,0.2770556,0.2765131,0.2765131,0.2764009,0.2758584,0.2757462,0.2754469,0.2753346,0.2747921,0.2746799,0.2746799,0.2741374,0.2740252,0.2734827,0.2734266,0.272828,0.2727719,0.2726596,0.2723604,0.2722481,0.2717056,0.2710509,0.2709387,0.270284,0.2697415,0.2695732,0.2692177,0.268563,0.2685069,0.2679083,0.2672536,0.2671975,0.2665428,0.2660003,0.2658319,0.2654765,0.2648218,0.2647657,0.264111,0.2635124,0.2634563,0.2628577,0.2628016,0.26239,0.2617914,0.2617353,0.2611367,0.2610806,0.2604259,0.2598273,0.2597712,0.2592287,0.2590604,0.2587049,0.2581625,0.2580502,0.2575078,0.2573394,0.2567408,0.2566847,0.2560861,0.2557868,0.2556746,0.2551321,0.2550198,0.2544774,0.2543651,0.2538227,0.2537104,0.253168,0.2529996,0.2526442,0.2525881,0.2520456,0.2519333,0.2513909,0.2512786,0.2507362,0.2506239,0.2499692,0.2493145,0.2490152,0.2483605,0.2481921,0.2475374,0.2468827,0.246228,0.2458726,0.2457603,0.2451056,0.2444509,0.2437962,0.2431415,0.2430293,0.2426177,0.241963,0.2413083,0.2406536,0.2404852,0.2399428,0.2392881,0.2389326,0.2388204,0.2382218,0.2375671,0.2369124,0.2368563,0.2362016,0.2358461,0.2351914,0.2351353,0.2344806,0.2338259,0.2332273,0.2330589,0.2325165,0.2321049,0.2319927,0.2313941,0.2307394,0.2300847,0.22943,0.2290184,0.2283637,0.2281954,0.2275406,0.2268859,0.2262312,0.2258197,0.225165,0.2245103,0.2243419,0.2236872,0.2230325,0.2223778,0.2219662,0.2213115,0.2206568,0.2204885,0.2198337,0.2192913,0.2188797,0.218225,0.2180567,0.2175142,0.2168595,0.2162048,0.2160364,0.215681,0.2150263,0.2143716,0.2142032,0.2136607,0.213006,0.2123513,0.2119398,0.2118837,0.211229,0.2105742,0.2099757,0.2098073,0.2092648,0.2088533,0.2086849,0.2080863,0.2074316,0.2073755,0.2067208,0.2061222,0.2059538,0.2054114,0.2049998,0.2044574,0.204289,0.2036904,0.2030357,0.2029796,0.2023249,0.2019695,0.2018011,0.2012586,0.2006039,0.2004917,0.1999492,0.1997808,0.1991823,0.1987707,0.1987146,0.1981721,0.1975174,0.1974052,0.1967505,0.196208,0.1960958,0.195441,0.1953849,0.1949734,0.1943748,0.1943187,0.193664,0.1935517,0.1930093,0.1923545,0.1922423,0.191943,0.1918308,0.1912322,0.1911199,0.1905775,0.1899228,0.1898105,0.189268,0.1890997,0.1887443,0.1882018,0.1880896,0.1874348,0.1873787,0.1867801,0.1866118,0.1860693,0.1859571,0.1854146,0.1850031,0.1849469,0.1843483,0.1842922,0.1836375,0.1835253,0.1829828,0.1828706,0.1822159,0.1821597,0.1818043,0.1811496,0.1810935,0.1804949,0.1804388,0.1797841,0.1797841,0.1796718,0.1791293,0.1791293,0.1790171,0.1784746,0.1784746,0.1783624,0.1780631,0.1780631,0.178007,0.1774084,0.1774084,0.1773523,0.1767537,0.1767537,0.1766976,0.1762112,0.176099,0.1760429,0.1760429,0.1754443,0.1753881,0.1753881,0.1752759,0.1750327,0.1749766,0.1749766,0.174378,0.174378,0.1743219,0.1742097,0.1737233,0.1736672,0.1736672,0.1735549,0.1730686,0.1730125,0.1729002,0.1729002,0.1723578,0.1722455,0.1719462,0.171834,0.1712915,0.1711232,0.1705807,0.1704684,0.1704123,0.1698137,0.1697576,0.169159,0.1691029,0.1685043,0.1684482,0.1683359,0.1680367,0.1679244,0.1673819,0.1672697,0.1667272,0.166615,0.1659603,0.1659042,0.1653056,0.1652494,0.164894,0.1648379,0.1647818,0.1641832,0.1641271,0.1635285,0.1634724,0.1628738,0.1628177,0.1621629,0.1620507,0.1617514,0.1616392,0.1610967,0.1609845,0.160442,0.1603297,0.1602736,0.159675,0.1596189,0.1590203,0.1589642,0.1583656,0.1583095,0.1579541,0.1578418,0.1577296,0.1571871,0.1570749,0.1565324,0.1564202,0.1558777,0.1557655,0.155223,0.1551108,0.1550546,0.1546992,0.1546431,0.1540445,0.1539884,0.1538761,0.1533337,0.1532214,0.152679,0.1525667,0.1525106,0.151912,0.1518559,0.1515566,0.1514444,0.1509019,0.1507896,0.1507335,0.1501349,0.1500788,0.1499666,0.1494802,0.1494241,0.1493119,0.1488255,0.1487694,0.1486572,0.1481147,0.1481147,0.1480024,0.1477031,0.1475909,0.1475909,0.1470484,0.1469362,0.1469362,0.1468801,0.1462815,0.1462254,0.1462254,0.1456268,0.1456268,0.1455707,0.1455707,0.1449721,0.1449159,0.1449159,0.1446166,0.1446166,0.1445044,0.1445044,0.1439619,0.1438497,0.1438497,0.1437936,0.1433072,0.143195,0.1431389,0.1431389,0.1425403,0.1425403,0.1424842,0.1424842,0.1418856,0.1418856,0.1418294,0.1417172,0.1412309,0.1411747,0.1411747,0.1410625,0.1408193,0.1407632,0.1407632,0.140651,0.1401085,0.1401085,0.1399962,0.1399962,0.1394538,0.1393415,0.1393415,0.1392854,0.1386868,0.1386868,0.1386307,0.1385746,0.1380882,0.137976,0.1379199,0.1379199,0.1375645,0.1375083,0.1375083,0.1369097,0.1368536,0.1368536,0.1367414,0.136255,0.1361989,0.1360867,0.1360867,0.1355442,0.1355442,0.135432,0.135432,0.1348895,0.1347773,0.1347773,0.1347211,0.134478,0.1343657,0.1343657,0.1343096,0.133711,0.133711,0.1336549,0.1336549,0.1335426,0.1330563,0.1330002,0.1330002,0.1328879,0.1323455,0.1323455,0.1322332,0.1322332,0.1316908,0.1316908,0.1316346,0.1316346,0.131036,0.131036,0.1309799,0.1308677,0.1308677,0.1305684,0.1305684,0.1304561,0.1304561,0.1299137,0.1299137,0.1298014,0.1297453,0.129259,0.1291467,0.1291467,0.1290906,0.1286043,0.128492,0.1284359,0.1284359,0.1278373,0.1278373,0.1277812,0.1277812,0.1274258,0.1273696,0.1273696,0.1272574,0.1267149,0.1267149,0.1266027,0.1260602,0.125948,0.125948,0.1254055,0.1253494,0.1252371,0.1252371,0.1246947,0.1245824,0.1245263,0.1242831,0.1241709,0.1241148,0.1235162,0.1235162,0.1234601,0.1228615,0.1228615,0.1228054,0.1226931,0.1222068,0.1221507,0.1220384,0.1220384,0.1214959,0.1214959,0.1213837,0.1213276,0.1208412,0.120729,0.120729,0.1206729,0.1203175,0.1203175,0.1202613,0.1201491,0.1196627,0.1196066,0.1196066,0.119008,0.1189519,0.1189519,0.1188958,0.1184094,0.1182972,0.1182411,0.1182411,0.1176425,0.1176425,0.1175864,0.1174741,0.117231,0.1171748,0.1171748,0.1170626,0.1165201,0.1165201,0.1164079,0.1164079,0.1158654,0.1157532,0.1157532,0.1152107,0.1152107,0.1150985,0.1150423,0.114556,0.1144437,0.1143876,0.1143876,0.113789,0.113789,0.1137329,0.1133775,0.1133775,0.1133214,0.1132091,0.1127228,0.1126667,0.1125544,0.1120681,0.112012,0.1119558,0.1119558,0.1113572,0.1113011,0.1113011,0.1107025,0.1106464,0.1106464,0.1105342,0.1102349,0.1102349,0.1101226,0.1095802,0.1094679,0.1094679,0.1094118,0.1088132,0.1088132,0.1087571,0.1081585,0.1081585,0.1081024,0.1081024,0.1075038,0.1074477,0.1074477,0.1073354,0.1070361,0.1070361,0.1069239,0.1063814,0.1063814,0.1062692,0.1062131,0.1057267,0.1056706,0.1056706,0.1055584,0.1055584,0.1050159,0.1049036,0.1049036,0.1048475,0.1043612,0.1042489,0.1042489,0.1041928,0.1041928,0.1035942,0.1035942,0.1035381,0.1035381,0.1031827,0.1031827,0.1030143,0.1024719,0.1023596,0.1018171,0.1017049,0.1016488,0.1010502,0.1009941,0.1003955,0.1003394,0.09998395,0.09981559,0.09975947,0.099217,0.09910475,0.09856228,0.09845004,0.09790757,0.09779533,0.09773921,0.0970845,0.09697226,0.09667297,0.09656072,0.09590601,0.09584989,0.0952513,0.09519518,0.09454047,0.09442823,0.09388576,0.09377352,0.09317493,0.09306269,0.09276339,0.09265115,0.09199644,0.09194032,0.09134173,0.09117337,0.0906309,0.09051866,0.08997619,0.08986395,0.08980783,0.08945241,0.08939629,0.0887977,0.08874158,0.08862934,0.08808687,0.08797463,0.08743216,0.08731992,0.0872638,0.08672133,0.08660909,0.08606662,0.08595438,0.08589825,0.08554284,0.08554284,0.08548672,0.08488813,0.08483201,0.08471977,0.0841773,0.0841773,0.08406506,0.08352259,0.08341035,0.08335422,0.08275563,0.08275563,0.08245634,0.0823441,0.08228798,0.08168939,0.08163327,0.08163327,0.08103468,0.08097856,0.08092244,0.08081019,0.08032385,0.08026773,0.08015548,0.07961301,0.07950077,0.07950077,0.07920148,0.07908924,0.07903312,0.07854677,0.07843453,0.07837841,0.07777982,0.07772369,0.07772369,0.0771251,0.07706898,0.07706898,0.07695674,0.07647039,0.07641427,0.07641427,0.07630203,0.07575956,0.07575956,0.07564732,0.07564732,0.07534803,0.07534803,0.07523579,0.07523579,0.07469332,0.07469332,0.07458107,0.07452495,0.07403861,0.07398248,0.07398248,0.07387024,0.07387024,0.07332777,0.07332777,0.07321553,0.07321553,0.07267306,0.07267306,0.07256082,0.07256082,0.0725047,0.07226153,0.07214929,0.07214929,0.07209317,0.07160682,0.07149458,0.07149458,0.07149458,0.07143845,0.07095211,0.07083986,0.07083986,0.07078374,0.07078374,0.0702974,0.07018515,0.07018515,0.07012903,0.07012903,0.06964268,0.06953044,0.06953044,0.06947432,0.06947432,0.06911891,0.06911891,0.06911891,0.06906279,0.06906279,0.0684642,0.0684642,0.06840808,0.06840808,0.06780949,0.06780949,0.06775336,0.06775336,0.0672109,0.0672109,0.06709865,0.06709865,0.06704253,0.06655619,0.06644394,0.06644394,0.06638782,0.06590147,0.06578923,0.06578923,0.06578923,0.06573311,0.06573311,0.0653777,0.0653777,0.06532158,0.06532158,0.06520933,0.06472299,0.06466687,0.06466687,0.06466687,0.06455462,0.06406828,0.06401215,0.06401215,0.06389991,0.06389991,0.06389991,0.06335744,0.06335744,0.06335744,0.0632452,0.0632452,0.06318908,0.06270273,0.06270273,0.06259049,0.06259049,0.06259049,0.06253437,0.0622912,0.0622912,0.06217896,0.06217896,0.06217896,0.06212284,0.06212284,0.06163649,0.06152425,0.06152425,0.06146812,0.06146812,0.06146812,0.06086953,0.06086953,0.06086953,0.06081341,0.06081341,0.06075729,0.06027094,0.06027094,0.0601587,0.0601587,0.0601587,0.06010258,0.05961623,0.05950399,0.05950399,0.05950399,0.05950399,0.05950399,0.05944787,0.05896152,0.05896152,0.05896152,0.05896152,0.05884928,0.05884928,0.05884928,0.05884928,0.05879316,0.05854999,0.05854999,0.05854999,0.05854999,0.05843775,0.05843775,0.05843775,0.05843775,0.05838163,0.05789528,0.05789528,0.05789528,0.05789528,0.05778304,0.05778304,0.05778304,0.05778304,0.05778304,0.05778304,0.05724057,0.05724057,0.05724057,0.05724057,0.05724057,0.05712832,0.05712832,0.05712832,0.05712832,0.0570722,0.05658585,0.05658585,0.05658585,0.05658585,0.05647361,0.05647361,0.05647361,0.05647361,0.05647361,0.05641749,0.05593114,0.05593114,0.05593114,0.05593114,0.0558189,0.0558189,0.0558189,0.0558189,0.05576278,0.05576278,0.05551961,0.05551961,0.05551961,0.05540737,0.05540737,0.05540737,0.05540737,0.05540737,0.05535125,0.05535125,0.0548649,0.0548649,0.05475266,0.05475266,0.05475266,0.05475266,0.05475266,0.05469654,0.05469654,0.05469654,0.05421019,0.05421019,0.05409795,0.05409795,0.05409795,0.05409795,0.05409795,0.05404182,0.05404182,0.05404182,0.05355548,0.05344323,0.05344323,0.05344323,0.05344323,0.05344323,0.05338711,0.05338711,0.05338711,0.05338711,0.05290077,0.05284464,0.05284464,0.05284464,0.05284464,0.0527324,0.0527324,0.0527324,0.0527324,0.0527324,0.05243311,0.05243311,0.05243311,0.05243311,0.05243311,0.05232087,0.05232087,0.05232087,0.05232087,0.05232087,0.0517784,0.0517784,0.0517784,0.0517784,0.05166616,0.05166616,0.05166616,0.05166616,0.05166616,0.05161004,0.05112369,0.05112369,0.05112369,0.05112369,0.05101145,0.05101145,0.05101145,0.05101145,0.05095533,0.05095533,0.05046898,0.05046898,0.05046898,0.05035674,0.05035674,0.05035674,0.05035674,0.05035674,0.05030061,0.05030061,0.04981427,0.04981427,0.04981427,0.04970202,0.04970202,0.04970202,0.04970202,0.0496459,0.0496459,0.0496459,0.04915956,0.04915956,0.04904731,0.04904731,0.04904731,0.04904731,0.04904731,0.04899119,0.04899119,0.04899119,0.04874802,0.04863578,0.04863578,0.04863578,0.04863578,0.04863578,0.04857966,0.04857966,0.04857966,0.04857966,0.04857966,0.04798107,0.04798107,0.04798107,0.04798107,0.04798107,0.04792495,0.04792495,0.04792495,0.04792495,0.04781271,0.04732636,0.04732636,0.04732636,0.04732636,0.04727024,0.04727024,0.04727024,0.04727024,0.04727024,0.04715799,0.04667165,0.04667165,0.04667165,0.04661553,0.04661553,0.04661553,0.04661553,0.04661553,0.0465594,0.0465594,0.04607306,0.04607306,0.04607306,0.04596081,0.04596081,0.04596081,0.04596081,0.04596081,0.04590469,0.04590469,0.04566152,0.04566152,0.04554928,0.04554928,0.04554928,0.04554928,0.04554928,0.04549316,0.04549316,0.04549316,0.04500681,0.04500681,0.04489457,0.04489457,0.04489457,0.04489457,0.04483845,0.04483845,0.04483845,0.04483845,0.0443521,0.04423986,0.04423986,0.04423986,0.04423986,0.04423986,0.04418374,0.04418374,0.04418374,0.04418374,0.04358515,0.04358515,0.04358515,0.04358515,0.04358515,0.04352903,0.04352903,0.04352903,0.04352903,0.04352903,0.04293044,0.04293044,0.04293044,0.04293044,0.04293044,0.04287431,0.04287431,0.04287431,0.04287431,0.04276207,0.0425189,0.0425189,0.0425189,0.0425189,0.04246278,0.04246278,0.04246278,0.04246278,0.04246278,0.04235054,0.04186419,0.04186419,0.04186419,0.04180807,0.04180807,0.04180807,0.04180807,0.04180807,0.04169583,0.04169583,0.04120948,0.04120948,0.04120948,0.04115336,0.04115336,0.04115336,0.04115336,0.04115336,0.04104112,0.04104112,0.04055477,0.04055477,0.04049865,0.04049865,0.04049865,0.04049865,0.04049865,0.04038641,0.04038641,0.04038641,0.03990006,0.03990006,0.03984394,0.03984394,0.03984394,0.03984394,0.03973169,0.03973169,0.03973169,0.03973169,0.03924535,0.03918923,0.03918923,0.03918923,0.03918923,0.03918923,0.0391331,0.0391331,0.0391331,0.0391331,0.03888993,0.03877769,0.03877769,0.03877769,0.03877769,0.03872157,0.03872157,0.03872157,0.03872157,0.03872157,0.03812298,0.03812298,0.03812298,0.03812298,0.03812298,0.03806686,0.03806686,0.03806686,0.03806686,0.03795462,0.03746827,0.03746827,0.03746827,0.03746827,0.03741215,0.03741215,0.03741215,0.03741215,0.03741215,0.03729991,0.03681356,0.03681356,0.03681356,0.03681356,0.03675744,0.03675744,0.03675744,0.03675744,0.0366452,0.0366452,0.03615885,0.03615885,0.03615885,0.03610273,0.03610273,0.03610273,0.03610273,0.03610273,0.03599048,0.03599048,0.03574731,0.03574731,0.03569119,0.03569119,0.03569119,0.03569119,0.03569119,0.03557895,0.03557895,0.03557895,0.0350926,0.0350926,0.03503648,0.03503648,0.03503648,0.03503648,0.03503648,0.03492424,0.03492424,0.03492424,0.03443789,0.03438177,0.03438177,0.03438177,0.03438177,0.03438177,0.03426953,0.03426953,0.03426953,0.03426953,0.03378318,0.03372706,0.03372706,0.03372706,0.03372706,0.03361482,0.03361482,0.03361482,0.03361482,0.03361482,0.03307235,0.03307235,0.03307235,0.03307235,0.03307235,0.03296011,0.03296011,0.03296011,0.03296011,0.03296011,0.03266081,0.03266081,0.03266081,0.03266081,0.03260469,0.03260469,0.03260469,0.03260469,0.03260469,0.03249245,0.0320061,0.0320061,0.0320061,0.0320061,0.03194998,0.03194998,0.03194998,0.03194998,0.03183774,0.03183774,0.03135139,0.03135139,0.03135139,0.03129527,0.03129527,0.03129527,0.03129527,0.03129527,0.03118303,0.03118303,0.03069668,0.03069668,0.03069668,0.03064056,0.03064056,0.03064056,0.03064056,0.03052832,0.03052832,0.03052832,0.03004197,0.03004197,0.02998585,0.02998585,0.02998585,0.02998585,0.02998585,0.02987361,0.02987361,0.02987361,0.02938726,0.02933114,0.02933114,0.02933114,0.02933114,0.02933114,0.0292189,0.0292189,0.0292189,0.0292189,0.02897572,0.0289196,0.0289196,0.0289196,0.0289196,0.02880736};

  // The step in the x vector (must be a constant step)
  double x_step = 10;

  // the integration depends only on the x step and the y values
  double actual_result = sed_integration_ptr->simpsonCubicIntegration(x_step, sed_flux);

  // difference between the python and the C++ result is < 3e-5 %
  BOOST_CHECK_CLOSE(python_result, actual_result, tolerence);
}

BOOST_FIXTURE_TEST_CASE( Resample_test, SedIntegrationFix ) {
  /*
   * Here we testing the resample function
   */
  tolerence = 1e-4;

  vector<double> wavelengths   = {3000., 3020., 3030., 3040. ,3060.};
  vector<double> efficiencies = {1., 2., 3., 4., 4.5};

  VectorPair* vectorPairFilter = sed_integration_ptr->resampleFilterSed(wavelengths, efficiencies, 10.);

  vector<double> newFilterWavelengths  = vectorPairFilter->getAxisX();
  vector<double> newFilterEfficiencies = vectorPairFilter->getAxisY();

  // About new wavelengths
  BOOST_CHECK_CLOSE(3010., newFilterWavelengths[1], tolerence);
  BOOST_CHECK_CLOSE(3050., newFilterWavelengths[5], tolerence);
  BOOST_CHECK_CLOSE(3060., newFilterWavelengths[6], tolerence);

  // About new efficiencies
  BOOST_CHECK_CLOSE(1.37784, newFilterEfficiencies[1], tolerence);
  BOOST_CHECK_CLOSE(4.44034, newFilterEfficiencies[5], tolerence);

  delete vectorPairFilter;

}

BOOST_FIXTURE_TEST_CASE( GetMinimumInterval_integration_test, SedIntegrationFix ) {

  BOOST_TEST_MESSAGE("--> Testing the getMinimumInterval function");

  tolerence = 1e-1;

  double expected_result = 5.;

  vector<double> dataVector   = {3000., 3020., 3025., 3040. ,3050.};

  double result = sed_integration_ptr->getMinimumInterval(dataVector);

  BOOST_CHECK_CLOSE(expected_result, result, tolerence);
}

BOOST_FIXTURE_TEST_CASE( ComputeMagnitude_integration_test, SedIntegrationFix ) {

  BOOST_TEST_MESSAGE("--> Testing the computeMagnitude function");

  tolerence = 1e-4;

  vector<double> expected_result = { -48.4756, -49.0302, -47.8374 };

  vector<double> dataFlux   = { 0.9, 1.5, 0.5 };

  vector<double> result = sed_integration_ptr->computeMagnitude(dataFlux);

  BOOST_CHECK_CLOSE(expected_result[0], result[0], tolerence);
  BOOST_CHECK_CLOSE(expected_result[1], result[1], tolerence);
  BOOST_CHECK_CLOSE(expected_result[2], result[2], tolerence);

}

BOOST_AUTO_TEST_SUITE_END ()
